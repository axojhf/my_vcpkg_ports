# This file is automatically generated from cmake.toml - DO NOT EDIT
# See https://github.com/build-cpp/cmkr for more information

cmake_minimum_required(VERSION 3.15)

project(safetyhook)

# Target: safetyhook
set(safetyhook_SOURCES
	"src/allocator.cpp"
	"src/easy.cpp"
	"src/inline_hook.cpp"
	"src/mid_hook.cpp"
	"src/os.linux.cpp"
	"src/os.windows.cpp"
	"src/utility.cpp"
	"src/vmt_hook.cpp"
)
if(BUILD_SHARED_LIBS)
	add_library(safetyhook SHARED)
	set_target_properties(safetyhook PROPERTIES WINDOWS_EXPORT_ALL_SYMBOLS ON)
else ()
	add_library(safetyhook STATIC)
endif()
target_sources(safetyhook PRIVATE ${safetyhook_SOURCES})
source_group(TREE ${CMAKE_CURRENT_SOURCE_DIR} FILES ${safetyhook_SOURCES})
target_compile_features(safetyhook PUBLIC
	cxx_std_23
)

if(MSVC) # msvc
	target_compile_options(safetyhook PRIVATE
		"/permissive-"
		"/W4"
		"/w14640"
	)
endif()

if((CMAKE_CXX_COMPILER_ID MATCHES "Clang" AND NOT CMAKE_CXX_COMPILER_FRONTEND_VARIANT MATCHES "^MSVC$") OR (CMAKE_C_COMPILER_ID MATCHES "Clang" AND NOT CMAKE_C_COMPILER_FRONTEND_VARIANT MATCHES "^MSVC$")) # clang
	target_compile_options(safetyhook PRIVATE
		-Wall
		-Wextra
		-Wshadow
		-Wnon-virtual-dtor
		-pedantic
	)
endif()

if(CMAKE_CXX_COMPILER_ID STREQUAL "GNU" OR CMAKE_C_COMPILER_ID STREQUAL "GNU") # gcc
	target_compile_options(safetyhook PRIVATE
		-Wall
		-Wextra
		-Wshadow
		-Wnon-virtual-dtor
		-pedantic
	)
endif()

target_include_directories(safetyhook PUBLIC
	"include/"
)

find_library(Zydis NAMES zydis)
# find_library(Zycore NAMES zycore)

find_path(ZYDIS_INCLUDE_DIR NAMES zydis/zydis.h)
#find_path(ZYCORE_INCLUDE_DIR NAMES zycore/zycore.h)
target_link_libraries(safetyhook PUBLIC ${Zydis})
#target_link_libraries(safetyhook PUBLIC ${Zycore})
target_include_directories(safetyhook PUBLIC ${ZYDIS_INCLUDE_DIR})
#target_include_directories(safetyhook PUBLIC ${ZYCORE_INCLUDE_DIR})

target_link_libraries(safetyhook PUBLIC
	ntdll
)

install(TARGETS safetyhook
    RUNTIME DESTINATION "bin"
    LIBRARY DESTINATION "lib"
    ARCHIVE DESTINATION "lib"
)

install(DIRECTORY "include" DESTINATION ${CMAKE_INSTALL_PREFIX})
